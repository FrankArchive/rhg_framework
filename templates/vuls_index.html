<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>漏洞管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
</head>

<body>
<!--./vuls/<name>/create: 创建新的漏洞条目-->
<!--./vuls/<name>/upload/<directory>/<script_name>: 上传相应脚本-->
<div class="container" align="center">

    <div>
        <h1 style="color: blue">漏洞管理界面</h1>
    </div>

    <br>

    <div align="center">
        <form role="form">
            <div class="from-grope">
                <label for="loopholeName" style="clear: both">
                    <h3>创建新的漏洞条目</h3>
                </label>
                <input class="form-control" placeholder="请输入漏洞名称" id="loopholeName" style="width: 400px">
                <button class="btn btn-default" style="margin-top: 10px"
                        onclick="addVul(document.querySelector('.vul_name_new').value)">
                    添加
                </button>
            </div>

            <div class="form-group">
                <label for="loopholeOption">
                    <h3>或选择一个漏洞条目</h3>
                </label>

                <br>

                <select class="form-control" id="loopholeOption" style="width: 400px;">
                    <option value="-1">select vulnerable</option>
                    {% for v in vul_list %}
                        <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>

        <br>

        {% for i in ['exp', 'fix', 'recognizer'] %}
            <div style="width: 350px">
                <form method="post" class="upload_{{ i }}" role="form" enctype="multipart/form-data">
                    <div style="clear: both">
                        <input class="btn btn-default" name="file" type="file" accept=".py" style="width: 200px;height: 35px;float: left">
                        <input class="form-control btn btn-primary" type="submit" value="上传新{{ i }}"
                               style="width: 150px; float: left">
                        <br>
                    </div>
                </form>
            </div>

            <br>
            <br>

            <script>const fileupload_{{i}} = document.querySelector('.upload_{{i}}');</script>
        {% endfor %}

    <br>
    <br>

        <footer>
            <h3>注: 新的recognizer会覆盖原来的识别脚本</h3>
        </footer>
    </div>
</div>





<script>
    function addVul(v) {
        window.location.href = '/vuls/' + v + '/create';
    }

    const vul_select = document.querySelector('.vul_name');
    vul_select.addEventListener(
        'change', async (e) => {
            const vul_page = document.querySelector('.vul_page');
            if (e.target.value == '-1') return;
            await fetch('./vuls/' + e.target.value)
                .then(response => {
                    response.text().then((s) => {
                        vul_page.innerHTML = s;
                    })
                });
            {% for i in ['exp', 'fix', 'recognizer'] %}
                fileupload_{{ i }}.action = '/vuls/' + e.target.value + '/upload/{{i}}';
            {% endfor %}
        }
    )
</script>


</body>
</html>